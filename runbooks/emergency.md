# 緊急対応ランブック

- **目的**: 本番障害発生時に迅速かつ確実な初動と復旧を行う。

## 1. インシデント検知
- Slack `#system-alert` でアラート受信。
- ユーザー報告、監視ツールの通知など。

## 2. 初動
1. アラート受信者は 5 分以内に対応宣言（Slack スレッド）。
2. 影響範囲を確認（全ユーザー / 一部機能など）。
3. 重大度を判定（S1: 全停止、S2: 一部停止、S3: 軽微）。

## 3. 切り分け
- Vercel Dashboard → 直近デプロイ / ログ確認。
- Supabase Dashboard → SQL 実行状況 / リソース使用率。
- アプリログ（`postSlackModeration` の詳細やサーバーログ）を確認。

## 4. 対処
- **最新リリースに起因**: 直前のデプロイをロールバック。
- **環境変数 / 秘密鍵問題**: Vercel 環境変数を修正し再デプロイ。
- **Supabase 障害**: Status を確認し復旧見込みを共有。
- **Slack Webhook 障害**: Webhook URL をローテーション。

## 5. コミュニケーション
- Slack スレッドで経過を更新（10〜15 分間隔）。
- 利害関係者へ影響・対策・復旧見込みを共有。

## 6. 収束と再発防止
- 復旧後、原因と再発防止策をまとめる。
- 月次レビューで SLO 見直し、改善タスク化。

