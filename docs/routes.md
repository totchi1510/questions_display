# Routing Spec (Phase 2)

目的: URL構造と描画戦略（SSR/ISR/静的）を定義し、SEO・UXを両立させる。

## 主要ルート
- `/` （トップ/一覧）
  - 表示: 最新の質問一覧（公開分のみ）。ページングまたは無限スクロール。
  - 生成: サーバーコンポーネント。`revalidate: 30` などのISRで半分静的運用。

- `/ask` （投稿フォーム）
  - 表示: 簡易投稿フォーム。NGワード/長さチェックはクライアント＋サーバー二重で。
  - 送信: サーバーアクション経由でINSERT。完了後トップへ遷移。

- `/archive/[YYYY-MM]` （月次アーカイブ）
  - 表示: 指定月のアーカイブ済み質問。
  - 生成: 静的 or ISR。`generateStaticParams`で近月のみ事前生成、過去はオンデマンド。

- `/admin/review` （モデレーション審査）
  - 表示: `pending_reviews` を処理する一覧＋承認/却下。QR Cookieの`moderator|admin`のみ表示。
  - 生成: サーバーコンポーネント（常時動的）。

- `/admin/qr` （QR発行）
  - 表示: `qr_tokens` の発行/失効。QR画像のDL。
  - 生成: サーバーコンポーネント（常時動的）。

- `/admin/logs` （監査ログ）
  - 表示: `moderation_logs` の検索/絞り込み。
  - 生成: サーバーコンポーネント（常時動的）。

## SEO/パフォーマンス方針
- 一覧/アーカイブはISRでCDNヒット率を上げる。要更新時はタグ/パス再検証を使用。
- 管理画面は認証必須のため常時動的（SSR）。
- 画像/静的アセットはCDN配信。OGPはトップ/アーカイブの最低限を提供。

## アクセス制御との接続
- Phase 1のCookieから`role`を読み、サーバー側でルートの可否を判断。
- UI上のリンクはロールに応じて出し分けるが、最終制御はサーバーで行う。

