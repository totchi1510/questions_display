# Contributing

このプロジェクトへの貢献にあたって、DBマイグレーション運用ルールを以下に定めます。

## DB マイグレーション運用

- 置き場所: `supabase/migrations/`
- 命名規則: `YYYYMMDDHHMMSS_description.sql`（UTC、半角小文字・数字・`-`/`_` のみ）
  - 例: `20251007_120000_add_questions_table.sql`
- 中身: 前方のみ（up）の変更を記述します。ロールバックは別PRで議論・合意のうえで実装します。
- 生成方法: まずローカルでスキーマを検討し、手書きでSQLを作成してください（Supabase CLIの`db diff`で補助してもOK）。
- レビュー観点:
  - 命名規則を満たしているか
  - 既存データの互換性が担保されているか（既存列の変更に注意）
  - インデックス/制約が適切か
  - 本番適用時の実行時間やロック影響が小さいか

### ローカル検証の目安

ローカルでSupabase（Postgres）を起動し、スキーマ適用を確認します。

```bash
supabase start              # 初回のみ
# 必要に応じて shadow DB で検証
# supabase db reset などは既存データが消えるため注意
```

### CI での検証

CI（GitHub Actions）では、以下を検証します。

- `supabase/migrations` に `.sql` が最低1件あること
- ファイル名が命名規則 `^[0-9]{14}_[a-z0-9_-]+\.sql$` に一致すること
- ファイルがテキストファイルであること

Supabase への実接続を伴う `db push` は、別途シークレット/接続情報を準備できた段階で導入します。

---

その他のコーディング規約やコミットルールは、必要に応じて本ドキュメントに追記していきます。

